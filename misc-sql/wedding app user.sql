SELECT EXTRACT(YEAR
               FROM u.created_at) created_year,
       EXTRACT(MONTH
               FROM u.created_at) created_month,
       SUM(CASE WHEN fb.spree_user_id IS NOT NULL
           AND fb.value IS NOT NULL
           AND fb.value NOT LIKE '%[]%' THEN 1 ELSE 0 END)::DECIMAL / COUNT(*)::DECIMAL percent_fb_users
FROM spree_users u
LEFT JOIN facebook_data fb ON fb.spree_user_id = u.id
GROUP BY EXTRACT(YEAR
                 FROM u.created_at),
         EXTRACT(MONTH
                 FROM u.created_at) -- created_year | created_month |    percent_fb_users
-- --------------+---------------+------------------------
--          2013 |             7 | 1.00000000000000000000
--          2013 |             8 | 0.01363271852445870088
--          2013 |             9 | 0.00369617445943448531
--          2013 |            10 | 0.00179533213644524237
--          2013 |            11 | 0.01453957996768982229
--          2013 |            12 | 0.00860585197934595525
--          2014 |             1 | 0.00348432055749128920
--          2014 |             2 | 0.01492537313432835821
--          2014 |             3 | 0.01437699680511182109
--          2014 |             4 | 0.02278481012658227848
--          2014 |             5 | 0.02133516861665519615
--          2014 |             6 | 0.02066772655007949126
--          2014 |             7 | 0.02106567534076827757
--          2014 |             8 | 0.03042198233562315996
--          2014 |             9 | 0.02631578947368421053
--          2014 |            10 | 0.03830480847595762021
--          2014 |            11 | 0.02551640340218712029
--          2014 |            12 | 0.04069767441860465116
--          2015 |             1 | 0.03500473036896877956
--          2015 |             2 | 0.03083151666147617565
--          2015 |             3 | 0.03433208489388264669
--          2015 |             4 | 0.06451612903225806452
--          2015 |             5 | 0.05951077035414384812
--          2015 |             6 | 0.07667103538663171691
--          2015 |             7 | 0.07990735379270411118
--          2015 |             8 | 0.15022935779816513761
--          2015 |             9 | 0.26145339652448657188
--          2015 |            10 | 0.99948691636736788096
--          2015 |            11 | 0.99774943735933983496
--          2015 |            12 | 0.99916457811194653300
--          2016 |             1 | 0.99488636363636363636
--          2016 |             2 | 0.99487657196087564043
--          2016 |             3 | 0.99731663685152057245
--          2016 |             4 | 0.99813571961222967934
--          2016 |             5 | 0.99571248423707440101
--          2016 |             6 | 0.99794520547945205479
--          2016 |             7 | 0.99669966996699669967
--          2016 |             8 | 0.98476190476190476190
--          2016 |             9 | 0.98225691980127750177
--          2016 |            10 | 0.97791981406159209762
--          2016 |            11 | 0.97827661115133960898
--          2016 |            12 | 0.97198275862068965517
--          2017 |             1 | 0.99132947976878612717
--          2017 |             2 | 0.99155736469169304990
--          2017 |             3 | 0.98248407643312101911