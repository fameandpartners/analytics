-- How many spree_order records have no bill_address_id month over month

SELECT EXTRACT(YEAR
               FROM created_at) created_year,
       EXTRACT(MONTH
               FROM created_at) created_month,
       COUNT(*),
       SUM(CASE WHEN bill_address_id IS NOT NULL THEN 1 END) -- orders with billing address
FROM spree_orders
GROUP BY created_year,
         created_month -- created_year | created_month |  count  | sum
-- --------------+---------------+---------+------
--          2013 |             8 |      88 |   88
--          2013 |             9 |      32 |   32
--          2013 |            10 |      20 |   20
--          2013 |            11 |      28 |   28
--          2013 |            12 |      15 |   15
--          2014 |             1 |      12 |   12
--          2014 |             2 |      16 |   16
--          2014 |             3 |      57 |   56
--          2014 |             4 |     139 |  139
--          2014 |             5 |     107 |  107
--          2014 |             6 |     102 |  102
--          2014 |             7 |     113 |  113
--          2014 |             8 |     230 |  230
--          2014 |             9 |     291 |  291
--          2014 |            10 |     379 |  379
--          2014 |            11 |     209 |  209
--          2014 |            12 |     130 |  130
--          2015 |             1 |     199 |  199
--          2015 |             2 |     325 |  325
--          2015 |             3 |    1412 | 1412
--          2015 |             4 |    3216 | 3215
--          2015 |             5 |    2260 | 2260
--          2015 |             6 |  296253 |  796
--          2015 |             7 |  781595 |  716
--          2015 |             8 |  987714 | 1178
--          2015 |             9 | 1102681 |  781
--          2015 |            10 | 1152610 |  971
--          2015 |            11 |  965087 |  529
--          2015 |            12 |  839221 |  375
--          2016 |             1 |  857792 | 1059
--          2016 |             2 |  791837 | 1195
--          2016 |             3 |  897173 | 2980
--          2016 |             4 | 1068866 | 4514
--          2016 |             5 | 1128991 | 2806
--          2016 |             6 | 1144701 | 1023
--          2016 |             7 | 1126110 |  743
--          2016 |             8 |  930204 | 1084
--          2016 |             9 |  962271 | 1100
--          2016 |            10 | 1298889 | 1450
--          2016 |            11 | 1076548 | 1230
--          2016 |            12 |  957828 |  749
--          2017 |             1 |  679234 |  616